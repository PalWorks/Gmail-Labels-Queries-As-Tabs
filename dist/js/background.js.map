{
  "version": 3,
  "sources": ["../../node_modules/@inboxsdk/core/background.js", "../../src/background.ts"],
  "sourcesContent": ["/* global chrome */\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n  if (message.type === 'inboxsdk__injectPageWorld' && sender.tab) {\n    if (chrome.scripting) {\n      // MV3\n      let documentIds;\n      let frameIds;\n      if (sender.documentId) {\n        // Protect against https://github.com/w3c/webextensions/issues/8 in\n        // browsers (Chrome 106+) that support the documentId property.\n        // Protections for other browsers happen inside the injected script.\n        documentIds = [sender.documentId];\n      } else {\n        frameIds = [sender.frameId];\n      }\n      chrome.scripting.executeScript({\n        target: { tabId: sender.tab.id, documentIds, frameIds },\n        world: 'MAIN',\n        files: ['pageWorld.js'],\n      });\n      sendResponse(true);\n    } else {\n      // MV2 fallback. Tell content script it needs to figure things out.\n      sendResponse(false);\n    }\n  }\n});\n", "/**\n * background.ts\n *\n * Service worker for the extension.\n * Handles opening the options page.\n */\n\nimport '@inboxsdk/core/background.js';\n\nchrome.runtime.onMessage.addListener((message, sender, sendResponse) => {\n    if (message.action === 'openOptions') {\n        chrome.runtime.openOptionsPage();\n    } else if (message.action === 'DOWNLOAD_FILE') {\n        try {\n            console.log(\"Background: Received DOWNLOAD_FILE request\");\n\n            if (!chrome.downloads) {\n                throw new Error(\"chrome.downloads API is not available\");\n            }\n\n            // Use Base64 encoding to avoid character issues\n            // Wrap in try-catch specifically for encoding issues\n            let base64Data;\n            try {\n                base64Data = btoa(unescape(encodeURIComponent(message.data)));\n            } catch (e) {\n                throw new Error(\"Failed to encode data: \" + (e as Error).message);\n            }\n\n            const url = 'data:application/json;base64,' + base64Data;\n\n            chrome.downloads.download({\n                url: url,\n                filename: message.filename,\n                saveAs: false,\n                conflictAction: 'uniquify'\n            }, (downloadId) => {\n                if (chrome.runtime.lastError) {\n                    console.error(\"Background: Download failed:\", chrome.runtime.lastError);\n                    sendResponse({ success: false, error: chrome.runtime.lastError.message });\n                } else {\n                    console.log(\"Background: Download started, ID:\", downloadId);\n                    sendResponse({ success: true, downloadId: downloadId });\n                }\n            });\n        } catch (e: any) {\n            console.error(\"Background: Error processing download request:\", e);\n            sendResponse({ success: false, error: e.message });\n        }\n        return true; // Keep channel open for async response\n    }\n});\n\nchrome.action.onClicked.addListener((tab) => {\n    if (tab.id) {\n        chrome.tabs.sendMessage(tab.id, { action: \"TOGGLE_SETTINGS\" })\n            .catch((err) => {\n                // Ignore errors if the content script isn't ready\n                console.warn(\"Could not send message to tab:\", err);\n            });\n    }\n});\n\n// Install hook: Open Welcome Page & Reload Gmail Tabs\nchrome.runtime.onInstalled.addListener((details) => {\n    if (details.reason === 'install') {\n        // 1. Open Welcome Page\n        chrome.tabs.create({ url: 'welcome.html' });\n\n        // 2. Set default labels (if needed)\n        const defaultLabels = [\n            { name: 'Inbox', id: 'default-inbox' },\n            { name: 'Sent', id: 'default-sent' }\n        ];\n        chrome.storage.sync.get(['labels'], (result) => {\n            if (!result.labels) {\n                chrome.storage.sync.set({ labels: defaultLabels });\n            }\n        });\n\n        // 3. Auto-Reload Open Gmail Tabs\n        // This ensures the content script is injected immediately\n        chrome.tabs.query({ url: \"https://mail.google.com/*\" }, (tabs) => {\n            tabs.forEach((tab) => {\n                if (tab.id) {\n                    chrome.tabs.reload(tab.id);\n                }\n            });\n        });\n    }\n});\n"],
  "mappings": ";;;AACA,SAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,QAAQ,iBAAiB;AACtE,QAAI,QAAQ,SAAS,+BAA+B,OAAO,KAAK;AAC9D,UAAI,OAAO,WAAW;AAEpB,YAAI;AACJ,YAAI;AACJ,YAAI,OAAO,YAAY;AAIrB,wBAAc,CAAC,OAAO,UAAU;AAAA,QAClC,OAAO;AACL,qBAAW,CAAC,OAAO,OAAO;AAAA,QAC5B;AACA,eAAO,UAAU,cAAc;AAAA,UAC7B,QAAQ,EAAE,OAAO,OAAO,IAAI,IAAI,aAAa,SAAS;AAAA,UACtD,OAAO;AAAA,UACP,OAAO,CAAC,cAAc;AAAA,QACxB,CAAC;AACD,qBAAa,IAAI;AAAA,MACnB,OAAO;AAEL,qBAAa,KAAK;AAAA,MACpB;AAAA,IACF;AAAA,EACF,CAAC;;;ACjBD,SAAO,QAAQ,UAAU,YAAY,CAAC,SAAS,QAAQ,iBAAiB;AACpE,QAAI,QAAQ,WAAW,eAAe;AAClC,aAAO,QAAQ,gBAAgB;AAAA,IACnC,WAAW,QAAQ,WAAW,iBAAiB;AAC3C,UAAI;AACA,gBAAQ,IAAI,4CAA4C;AAExD,YAAI,CAAC,OAAO,WAAW;AACnB,gBAAM,IAAI,MAAM,uCAAuC;AAAA,QAC3D;AAIA,YAAI;AACJ,YAAI;AACA,uBAAa,KAAK,SAAS,mBAAmB,QAAQ,IAAI,CAAC,CAAC;AAAA,QAChE,SAAS,GAAG;AACR,gBAAM,IAAI,MAAM,4BAA6B,EAAY,OAAO;AAAA,QACpE;AAEA,cAAM,MAAM,kCAAkC;AAE9C,eAAO,UAAU,SAAS;AAAA,UACtB;AAAA,UACA,UAAU,QAAQ;AAAA,UAClB,QAAQ;AAAA,UACR,gBAAgB;AAAA,QACpB,GAAG,CAAC,eAAe;AACf,cAAI,OAAO,QAAQ,WAAW;AAC1B,oBAAQ,MAAM,gCAAgC,OAAO,QAAQ,SAAS;AACtE,yBAAa,EAAE,SAAS,OAAO,OAAO,OAAO,QAAQ,UAAU,QAAQ,CAAC;AAAA,UAC5E,OAAO;AACH,oBAAQ,IAAI,qCAAqC,UAAU;AAC3D,yBAAa,EAAE,SAAS,MAAM,WAAuB,CAAC;AAAA,UAC1D;AAAA,QACJ,CAAC;AAAA,MACL,SAAS,GAAQ;AACb,gBAAQ,MAAM,kDAAkD,CAAC;AACjE,qBAAa,EAAE,SAAS,OAAO,OAAO,EAAE,QAAQ,CAAC;AAAA,MACrD;AACA,aAAO;AAAA,IACX;AAAA,EACJ,CAAC;AAED,SAAO,OAAO,UAAU,YAAY,CAAC,QAAQ;AACzC,QAAI,IAAI,IAAI;AACR,aAAO,KAAK,YAAY,IAAI,IAAI,EAAE,QAAQ,kBAAkB,CAAC,EACxD,MAAM,CAAC,QAAQ;AAEZ,gBAAQ,KAAK,kCAAkC,GAAG;AAAA,MACtD,CAAC;AAAA,IACT;AAAA,EACJ,CAAC;AAGD,SAAO,QAAQ,YAAY,YAAY,CAAC,YAAY;AAChD,QAAI,QAAQ,WAAW,WAAW;AAE9B,aAAO,KAAK,OAAO,EAAE,KAAK,eAAe,CAAC;AAG1C,YAAM,gBAAgB;AAAA,QAClB,EAAE,MAAM,SAAS,IAAI,gBAAgB;AAAA,QACrC,EAAE,MAAM,QAAQ,IAAI,eAAe;AAAA,MACvC;AACA,aAAO,QAAQ,KAAK,IAAI,CAAC,QAAQ,GAAG,CAAC,WAAW;AAC5C,YAAI,CAAC,OAAO,QAAQ;AAChB,iBAAO,QAAQ,KAAK,IAAI,EAAE,QAAQ,cAAc,CAAC;AAAA,QACrD;AAAA,MACJ,CAAC;AAID,aAAO,KAAK,MAAM,EAAE,KAAK,4BAA4B,GAAG,CAAC,SAAS;AAC9D,aAAK,QAAQ,CAAC,QAAQ;AAClB,cAAI,IAAI,IAAI;AACR,mBAAO,KAAK,OAAO,IAAI,EAAE;AAAA,UAC7B;AAAA,QACJ,CAAC;AAAA,MACL,CAAC;AAAA,IACL;AAAA,EACJ,CAAC;",
  "names": []
}
