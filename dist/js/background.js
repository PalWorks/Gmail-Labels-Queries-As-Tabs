"use strict";(()=>{chrome.runtime.onMessage.addListener((e,r,a)=>{if(e.type==="inboxsdk__injectPageWorld"&&r.tab)if(chrome.scripting){let o,t;r.documentId?o=[r.documentId]:t=[r.frameId],chrome.scripting.executeScript({target:{tabId:r.tab.id,documentIds:o,frameIds:t},world:"MAIN",files:["pageWorld.js"]}),a(!0)}else a(!1)});chrome.runtime.onMessage.addListener((e,r,a)=>{if(e.action==="openOptions")chrome.runtime.openOptionsPage();else if(e.action==="DOWNLOAD_FILE")try{if(console.log("Background: Received DOWNLOAD_FILE request"),!chrome.downloads)throw new Error("chrome.downloads API is not available");let o;try{o=btoa(unescape(encodeURIComponent(e.data)))}catch(n){throw new Error("Failed to encode data: "+n.message)}let t="data:application/json;base64,"+o;chrome.downloads.download({url:t,filename:e.filename,saveAs:!1,conflictAction:"uniquify"},n=>{chrome.runtime.lastError?(console.error("Background: Download failed:",chrome.runtime.lastError),a({success:!1,error:chrome.runtime.lastError.message})):(console.log("Background: Download started, ID:",n),a({success:!0,downloadId:n}))})}catch(o){console.error("Background: Error processing download request:",o),a({success:!1,error:o.message})}else e.action==="UNINSTALL_SELF"&&(console.log("Background: Received UNINSTALL_SELF request"),chrome.management&&chrome.management.uninstallSelf?chrome.management.uninstallSelf({showConfirmDialog:!0},()=>{chrome.runtime.lastError&&console.error("Background: Uninstall failed:",chrome.runtime.lastError)}):console.error("Background: chrome.management.uninstallSelf is not available. Check permissions."));return!0});var s="https://tally.so/r/D4BBRR?transparentBackground=1&formEventsForwarding=1";chrome.runtime.setUninstallURL&&chrome.runtime.setUninstallURL(s,()=>{console.log("Background: Uninstall URL set to",s)});chrome.action.onClicked.addListener(e=>{e.id&&chrome.tabs.sendMessage(e.id,{action:"TOGGLE_SETTINGS"}).catch(r=>{console.warn("Could not send message to tab:",r)})});chrome.runtime.onInstalled.addListener(e=>{if(e.reason==="install"){chrome.tabs.create({url:"welcome.html"});let r=[{name:"Inbox",id:"default-inbox"},{name:"Sent",id:"default-sent"}];chrome.storage.sync.get(["labels"],a=>{a.labels||chrome.storage.sync.set({labels:r})}),chrome.tabs.query({url:"https://mail.google.com/*"},a=>{a.forEach(o=>{o.id&&chrome.tabs.reload(o.id)})})}});})();
